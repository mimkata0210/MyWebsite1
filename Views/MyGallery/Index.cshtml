@model IEnumerable<MyWebsite1.Models.Photo>
@{
    ViewData["Title"] = "My Gallery";
    ViewData["CurrentPage"] = "My Gallery";
}

<h2>My Gallery</h2>

<!-- Бутон за качване -->
<a href="@Url.Action("Create", "MyGallery")" class="btn btn-pink mb-3">
    <i class="fas fa-upload"></i> Upload Image
</a>

<div id="photosList" class="d-flex flex-wrap gap-3">
    @foreach (var photo in Model)
    {
        <div class="photo-item text-center" data-id="@photo.Id" style="width: 200px;">
            <img src="data:image/jpeg;base64,@Convert.ToBase64String(photo.ImageData)"
                 alt="@photo.Title"
                 class="img-thumbnail mb-2"
                 style="width: 100%; height: auto;" />
            <p>@photo.Title</p>
            <button class="btn btn-outline-pink btn-sm delete-photo">Delete</button>
        </div>
    }
</div>

@section Scripts {
    <script>
        $(function () {
            $('#photosList').on('click', '.delete-photo', function () {
                if (!confirm('Are you sure you want to delete this photo?')) return;

                var container = $(this).closest('.photo-item');
                var photoId = container.data('id');

                $.ajax({
                    url: '/MyGallery/Delete',
                    type: 'POST',
                    data: { id: photoId }, // пращаме id в POST body
                    headers: {
                        'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function () {
                        container.fadeOut(300, function () { $(this).remove(); });
                    },
                    error: function () {
                        alert('Failed to delete photo. Please try again.');
                    }
                });
            });
        });
    </script>
}